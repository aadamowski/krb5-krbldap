# makefile: Constructs the Kerberos for Windows ticket manager
# Works for both k4 and k5 releases.
#
OBJS 	 = gss.obj gss-client.obj gss-misc.obj

##### Options
DEBUG 	 = 1
BUILDTOP =..\..
LIBDIR	 = $(BUILDTOP)\lib
GLIB	 = $(LIBDIR)\gssapi.lib
##WIN16##WLIB	 = $(LIBDIR)\winsock.lib
INCLUDES = /I$(BUILDTOP)\include /I$(BUILDTOP)\include\krb5

##### C Compiler
!if $(DEBUG)
CFLAGS 	 = $(CCOPTS2) $(INCLUDES) /Zi
!else
CFLAGS 	 = $(CCOPTS2) $(INCLUDES)
!endif

##### RC Compiler
RC 	 = rc
##WIN16##RFLAGS 	 = /nologo /D$(KRB)=1 $(INCLUDES)
##WIN32##RFLAGS 	 = $(INCLUDES)

##### CVTRES -- .res -> .obj converter
CVTRES = cvtres

##### Linker
LINK 	 = link
LIBS 	 = $(GLIB) $(WLIB)
##WIN16##SYSLIBS  = libw llibcew
##WIN32##SYSLIBS  = libc.lib kernel32.lib wsock32.lib user32.lib \
##WIN32##	gdi32.lib comdlg32.lib
!if $(DEBUG)
##WIN16##LFLAGS = /co /nologo /nod /nopackcode /map:full
##WIN32##LFLAGS = /nologo /nod /debug
!else
##WIN16##LFLAGS = /nologo /nod /nopackcode
##WIN32##LFLAGS = /nologo /nod
!endif

all:: makefile gss.exe

gss.exe: $*.def $*.res $(OBJS) $(LIBS)
##WIN16##	$(LINK) $(LFLAGS) $(OBJS), $@, $*.map, \
##WIN16##	  $(LIBS) $(SYSLIBS), $*.def
##WIN16##	$(RC) $(RFLAGS) /k $*.res $@
##WIN32##	$(LINK) $(LFLAGS) /map:$*.map /out:$@ $(OBJS) $(XOBJS) \
##WIN32##	  $(LIBS) $(SYSLIBS)

##WIN32##gss.res: gss.rc
##WIN32##	$(RC) $(RFLAGS) /r $*.rc

##WIN32##resource.obj: gss.res
##WIN32##	$(CVTRES) /nologo /out:resource.obj gss.res

$(OBJS) gss.res: gss.h

install::
	copy gss.exe ..\floppy

clean:: 
	if exist *.exe del *.exe
	if exist ..\floppy\gss.exe del ..\floppy\gss.exe
	if exist *.obj del *.obj
	if exist *.res del *.res
	if exist *.map del *.map
	if exist *.pdb del *.pdb
	if exist *.err del *.err

