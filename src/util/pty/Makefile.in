srcdir=	@srcdir@
VPATH=	@srcdir@
prefix=	@prefix@
LIBDIR=	@libdir@
INCDIR=	@includedir@
ARCHIVE=@ARCHIVE@
RANLIB=	@RANLIB@
AWK=	@AWK@
ETDIR=	$(srcdir)/../et
ET_INC=	$(ETDIR)
ET_H=	$(AWK) -f $(ETDIR)/et_h.awk outfile=$@
ET_C=	$(AWK) -f $(ETDIR)/et_c.awk outfile=$@
RM=	rm -f

DEFS=	@DEFS@

WHAT=	unix
all::	all-$(WHAT)
clean::	clean-$(WHAT)
check::

CFLAGS = $(CCOPTS) $(DEFS) $(LOCALINCLUDE)
SED = sed

.c.o:
	$(CC) $(CFLAGS) -c $(srcdir)/$*.c

OBJS=	cleanup.o getpty.o init_slave.o open_ctty.o open_slave.o \
	update_utmp.o update_wtmp.o vhangup.o void_assoc.o pty_err.o \
	logwtmp.o init.o

DONE::	$(OBJS) $(srcdir)/Makefile.in
	@echo $(OBJS) > DONE

# for pty-int.h
LOCALINCLUDE=-I. -I$(srcdir) -I$(ET_INC)

CFILES=	cleanup.c getpty.c init_slave.c open_ctty.c open_slave.c \
	update_utmp.c update_wtmp.c vhangup.c void_assoc.c pty_err.c \
	logwtmp.c init.c

SRCS=	pty_err.h $(CFILES)

all-unix:: pty_err.h libpty.a DONE

clean-unix::
	$(RM) libpty.a $(OBJS) pty_err.c pty_err.h DONE

depend::

install:: libpty.h
	$(INSTALL_DATA) $(srcdir)/libpty.h  $(DESTDIR)$(KRB5_INCDIR)/libpty.h

libpty.a: DONE
	$(RM) $@
	$(ARCHIVE) $@ $(OBJS)
	$(RANLIB) $@

clean-mac::
	$(RM) libpty.a
	$(RM) $(OBJS)

install::
	$(INSTALL_DATA) libpty.a $(DESTDIR)$(LIBDIR)/libpty.a
	$(RANLIB) $(DESTDIR)$(LIBDIR)/libpty.a

clean-unix:: clean-files

clean-mac:: clean-files

clean-files::
	rm -f *~ \#* *.bak \
		*.otl *.aux *.toc *.PS *.dvi *.x9700 *.ps \
		*.cp *.fn *.ky *.log *.pg *.tp *.vr \
		*.o profiled/?*.o libcom_err.a libcom_err_p.a \
		com_err.o compile_et \
		et.ar TAGS y.tab.c lex.yy.c error_table.c \
		et_lex.lex.c \
		test1.h test1.c test2.h test2.c test_et \
		eddep makedep *.ln

pty_err.o: pty_err.c
	$(CC) $(CFLAGS) -c $*.c

pty_err.h:: $(srcdir)/pty_err.et
	$(ET_H) $(srcdir)/pty_err.et

pty_err.c:: $(srcdir)/pty_err.et
	$(ET_C) $(srcdir)/pty_err.et
