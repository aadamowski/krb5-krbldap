#!/bin/sh

DUMMY=${TESTDIR=$TOP/testing}
DUMMY=${RESTORE_FILES=$TESTDIR/scripts/restore_files.sh}

# If it's set, set it to true
VERBOSE=${VERBOSE_TEST:+true}
# Otherwise, set it to false
DUMMY=${VERBOSE:=false}

v4files=false
while [ $# -gt 0 ] ; do
	case $1 in
		-start_servers)
			start_servers=$1
			;;
		-v4files)
			v4files=true
			;;
		*) 
			TOP=$1
			export TOP
			;;
	esac
	shift
done

# kill any running servers.

if $VERBOSE; then echo "Killing servers:"; fi

for pid in xxx \
	`$PS_ALL | grep krb5kdc | grep -v grep | awk '{print $2}'` \
	`$PS_ALL | grep kadmind | grep -v grep | awk '{print $2}'` \
	; do
	case "$pid" in
		xxx)
			;;
		*)
			if $VERBOSE; then $PS_PID$pid | grep -v COMMAND; fi
			kill $pid
			;;
	esac
done

# restore saved system config files
if $v4files; then
	$RESTORE_FILES $start_servers
fi
