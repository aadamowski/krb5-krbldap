CFLAGS = $(CCOPTS) $(DEFS)

##DOSBUILDTOP = ..
##DOSVERS_DIR = \vers

MAC_SUBDIRS = crypto krb5 gssapi kadm

all-unix::

all-mac::

CLEANLIBS = libkrb5.a libkdb5.a libcrypto.a libgssapi_krb5.a libdes425.a \
	libkrb425.a libkadm.a libkrb4.a libcom_err.a libpty.a \
	libss.a libkrb5util.a libgssapi.a \
	libkrb5.so libcrypto.so libkrb4.so libdes425.so

clean-mac:: clean-unix
clean-unix::
	$(RM) $(CLEANLIBS)

clean-windows::
	$(RM) krb5.dll krb5.lib krb5.bak krb5.map winsock.lib
	$(RM) gssapi.dll gssapi.lib gssapi.bak gssapi.map
#
# Windows stuff to make krb5.dll and krb5.lib. Currently it
# combines crypto, krb5, kadm and the util/et directories.
#
ALIB  = kadm\kadm.lib
CLIB  = crypto\crypto.lib
KLIB  = krb5\krb5.lib
GLIB  = gssapi\gssapi.lib
ETLIB = $(BUILDTOP)\util\et\comerr.lib
PLIB  = $(BUILDTOP)\util\profile\profile.lib
#MISCLIB = $(BUILDTOP)\util\misc\misc.lib
DES425LIB = des425\des425.lib
##WIN16##WLIB  = .\winsock.lib
LIBS  = $(ALIB) $(CLIB) $(KLIB) $(ETLIB) $(PLIB) $(DES425LIB)


##WIN32##WINLIBS = libc.lib kernel32.lib wsock32.lib user32.lib shell32.lib oldnames.lib
##WIN32##WINDLLFLAGS = /nodefaultlib /incremental:no /pdb:none /release \
##WIN32##		/nologo /align:0x1000 /base:0x1c000000 /dll /debug


##WIN16##lib-windows: winsock.lib krb5.lib gssapi.lib 
##WIN32##lib-windows: krb5.dll gssapi.dll krb4.dll



krb5.dll: $(LIBS) krb5.def win_glue.obj
##WIN16##	link /co /seg:400 /noe /nod /nol win_glue, krb5.dll, krb5.map, \
##WIN16##	   $(LIBS) ldllcew libw oldnames, krb5.def
##WIN16##	rc /nologo /p /k krb5.dll
##WIN32##	link $(WINDLLFLAGS) /def:$*.def /out:$*.dll \
##WIN32##	   win_glue.obj $(LIBS) $(WINLIBS)

krb5.lib: krb5.dll
##WIN16##	implib /nologo krb5.lib krb5.dll
##WIN32##	lib /nologo /out:$*.lib /def:$*.def $(LIBS) win_glue.obj

gssapi.dll: $(GLIB) $(LIBS) gssapi.def win_glue.obj
##WIN16##	link /co /seg:400 /noe /nod /nol win_glue, gssapi.dll, \
##WIN16##	   gssapi.map, $(LIBS) ldllcew libw oldnames, gssapi.def
##WIN16##	rc /nologo /p /k gssapi.dll
##WIN32##	link $(WINDLLFLAGS) /def:$*.def /out:$*.dll \
##WIN32##	   win_glue.obj $(GLIB) $(LIBS) $(WINLIBS)

gssapi.lib: gssapi.dll
##WIN16##	implib /nologo gssapi.lib gssapi.dll
##WIN32##	lib /nologo /out:$@ /def:$*.def $(GLIB) win_glue.obj

krb4.dll: krb4\krb4.lib krb4\krb4.def krb5.lib
##WIN16##	link /co /seg:400 /noe /nod /nol win_glue, krb4.dll, krb4.map, \
##WIN16##	   krb4\krb4.lib krb5.lib ldllcew libw oldnames, krb4\krb4.def
##WIN16##	rc /nologo /p /k krb4.dll
##WIN32##	link $(WINDLLFLAGS) /def:krb4\krb4.def /out:$*.dll \
##WIN32##	   krb4\krb4.lib krb5.lib $(WINLIBS)

krb4.lib: krb4.dll
##WIN16##	implib /nologo krb4.lib krb4.dll
##WIN32##	lib /nologo /out:$@ /def:krb4\krb4.def krb4\krb4.lib

sap_glue.obj: win_glue.c
	$(CC) $(CFLAGS) -DSAP_TIMEBOMB -I$(VERS_DIR) /c \
		/Fosap_glue.obj win_glue.c

win_glue.obj: win_glue.c
	$(CC) $(CFLAGS) /c win_glue.c



##WIN16##sapkrb5.dll: $(GLIB) $(LIBS) gssapi.def sap_glue.obj
##WIN16##	link /co /seg:400 /noe /nod /nol sap_glue, sapkrb5.dll, sapkrb5.map, \
##WIN16##	   $(LIBS) $(VERS_DIR)\vswin.lib ldllcew libw oldnames, sapkrb5.def
##WIN16##	rc /nologo /p /k sapkrb5.dll

##WIN16##winsock.lib:  winsock.def
##WIN16##	implib /nologo winsock.lib winsock.def



all-windows:: 
	@echo Making in lib\crypto
	cd crypto
	-$(MAKE) -$(MFLAGS)
	@echo Making in lib\kadm
	cd ..\kadm
	-$(MAKE) -$(MFLAGS) 
	@echo Making in lib\krb5
	cd ..\krb5
	-$(MAKE) -$(MFLAGS) 
	@echo Making in lib\gssapi
	cd ..\gssapi
	-$(MAKE) -$(MFLAGS) 
	@echo Making in lib\des425
	cd ..\des425
	-$(MAKE) -$(MFLAGS) 
#	@echo Making in lib\krb4
#	cd ..\krb4
#	-$(MAKE) -$(MFLAGS) 
	@echo Making in lib
	cd ..

all-windows:: krb5.lib gssapi.lib

clean-windows::
	@echo Making clean in lib\crypto
	cd crypto
	-$(MAKE) -$(MFLAGS) clean
	@echo Making clean in lib\kadm
	cd ..\kadm
	-$(MAKE) -$(MFLAGS) clean
	@echo Making clean in lib\krb5
	cd ..\krb5
	-$(MAKE) -$(MFLAGS) clean
	@echo Making clean in lib\gssapi
	cd ..\gssapi
	-$(MAKE) -$(MFLAGS) clean
	@echo Making clean in lib\des425
	cd ..\des425
	-$(MAKE) -$(MFLAGS) clean
	@echo Making clean in lib\krb4
	cd ..\krb4
	-$(MAKE) -$(MFLAGS) clean
	@echo Making clean in lib
	cd ..

