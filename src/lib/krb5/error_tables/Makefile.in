CFLAGS = $(CCOPTS) $(DEFS)

##DOSBUILDTOP = ..\..\..
##DOSMYNAME=error_tables
##DOSOBJFILE=..\err_tbls.lst

EHDRDIR=$(BUILDTOP)$(S)include$(S)krb5

# The "unixmac" and "includes" rules need to run in Makefile.in,
# without all the support glop like $(S) and $(BUILDTOP)...so, fake it.
#
# Faking things breaks VPATH support, which is a requirement for me -- TYT.
# You need to do this right!  Whatever config tools that you're using under
# the macintosh, is going to need to handle BUILDTOP and SRCTOP explicitly.
# Setting BUILDTOP and SRCTOP to be the same is Right Out.
#
#BUILDTOP2 = ../../..
#SRCTOP2 = $(BUILDTOP2)
#EHDRDIR2=$(BUILDTOP2)/include/krb5

.c.o:
	$(CC) $(CFLAGS) -c $*.c
@SHARED_RULE_LOCAL@

HDRS= asn1_err.h kdb5_err.h krb5_err.h kv5m_err.h adm_err.h
OBJS= asn1_err.$(OBJEXT) kdb5_err.$(OBJEXT) krb5_err.$(OBJEXT) \
      kv5m_err.$(OBJEXT) adm_err.$(OBJEXT) init_ets.$(OBJEXT)
ETSRCS= asn1_err.c kdb5_err.c krb5_err.c kv5m_err.c adm_err.c
SRCS= asn1_err.c kdb5_err.c krb5_err.c kv5m_err.c adm_err.c \
	$(srcdir)/init_ets.c

all-unix:: $(HDRS) shared $(OBJS)
all-mac:: $(OBJS)
all-windows:: $(OBJFILE)

##DOS$(OBJFILE): $(OBJS)
##DOS	$(RM) $(OBJFILE)
##DOS	$(LIBECHO) -p $(MYNAME)\ *.obj > $(OBJFILE)

shared:
	mkdir shared

unixmac: $(HDRS) $(SRCS)

awk-windows:
	$(AWK) -f $(SRCTOP)/util/et/et_h.awk outfile=asn1_err.h asn1_err.et
	$(AWK) -f $(SRCTOP)/util/et/et_h.awk outfile=kdb5_err.h kdb5_err.et
	$(AWK) -f $(SRCTOP)/util/et/et_h.awk outfile=krb5_err.h krb5_err.et
	$(AWK) -f $(SRCTOP)/util/et/et_h.awk outfile=adm_err.h adm_err.et
	$(AWK) -f $(SRCTOP)/util/et/et_h.awk outfile=kv5m_err.h kv5m_err.et
	$(AWK) -f $(SRCTOP)/util/et/et_c.awk outfile=asn1_err.c asn1_err.et
	$(AWK) -f $(SRCTOP)/util/et/et_c.awk outfile=kdb5_err.c kdb5_err.et
	$(AWK) -f $(SRCTOP)/util/et/et_c.awk outfile=krb5_err.c krb5_err.et
	$(AWK) -f $(SRCTOP)/util/et/et_c.awk outfile=adm_err.c adm_err.et
	$(AWK) -f $(SRCTOP)/util/et/et_c.awk outfile=kv5m_err.c kv5m_err.et
	if exist asn1_err.h copy asn1_err.h $(EHDRDIR)
	if exist kdb5_err.h copy kdb5_err.h $(EHDRDIR)
	if exist krb5_err.h copy krb5_err.h $(EHDRDIR)
	if exist adm_err.h copy adm_err.h $(EHDRDIR)
	if exist kv5m_err.h copy kv5m_err.h $(EHDRDIR)

#
# dependencies for traditional makes
#
asn1_err.$(OBJEXT): asn1_err.c
isode_err.$(OBJEXT): isode_err.c
kdb5_err.$(OBJEXT): kdb5_err.c
krb5_err.$(OBJEXT): krb5_err.c
adm_err.$(OBJEXT): adm_err.c
kv5m_err.$(OBJEXT): kv5m_err.c

clean-unix::
	$(RM) $(HDRS) $(ETSRCS) shared/*
clean-mac::
	$(RM) $(HDRS) $(ETSRCS)
clean-windows::

init_ets.o: $(srcdir)/init_ets.c
	$(CC) $(CFLAGS) -c $(srcdir)/$*.c
@SHARED_RULE@

# 
# This stuff is already dropped in by the autoconf generated configure scripts.
# (Blame Mark, not me for that; this was before we had pre.in and post.in, 
# we should probably move the error table rules from aclocal.m4 to pre.in)
#
#.SUFFIXES:  .h .c .et .ct
#
#.et.h:
#	awk -f $(SRCTOP2)/util/et/et_h.awk outfile=$*.h $<
#
#.et.c:
#	awk -f $(SRCTOP2)/util/et/et_c.awk outfile=$*.c $<
#
