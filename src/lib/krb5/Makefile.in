##DOSBUILDTOP = ..\..
##DOSLIBNAME=krb5.lib
##DOSOBJFILEDEP=asn1.lst ccache.lst err_tbls.lst free.lst keytab.lst krb.lst os.lst posix.lst rcache.lst
##DOSOBJFILELIST=@asn1.lst @ccache.lst @err_tbls.lst @free.lst @keytab.lst @krb.lst @os.lst @posix.lst @rcache.lst

ANAME_DBDEP=@ANAME_DBDEP@
ANAME_DBLIB=@ANAME_DBLIB@

TST=if test -n "`cat DONE`" ; then

MAC_SUBDIRS = error_tables asn.1 ccache keytab krb rcache free os posix 

LIB_SUBDIRS= error_tables asn.1 ccache ccache/stdio ccache/file ccache/memory \
	keytab keytab/file krb rcache free os posix \
        $(BUILDTOP)/util/profile
LIBUPDATE= $(BUILDTOP)/util/libupdate
LIBDONE= error_tables/DONE asn.1/DONE ccache/DONE ccache/stdio/DONE \
		ccache/file/DONE ccache/memory/DONE keytab/DONE \
		keytab/file/DONE krb/DONE rcache/DONE free/DONE os/DONE \
		posix/DONE $(BUILDTOP)/util/profile/DONE

#
CRYPTO_VER=@CRYPTO_SH_VERS@
COMERR_VER=@COMERR_SH_VERS@
DEPLIBS=$(TOPLIBD)/libcrypto.$(SHEXT).$(CRYPTO_VER) \
	$(TOPLIBD)/libcom_err.$(SHEXT).$(COMERR_VER) \
	$(ANAME_DBDEP)
SHLIB_LIBS=-lcrypto -lcom_err $(ANAME_DBLIB) @SHLIB_GEN@
SHLIB_LDFLAGS= $(LDFLAGS) @SHLIB_RPATH_DIRS@	
#	$(LD_UNRESOLVED_PREFIX)_et_list $(LD_UNRESOLVED_PREFIX)error_message
SHLIB_LIBDIRS= @SHLIB_LIBDIRS@

all-unix::
all-windows::

libkrb5.$(STEXT): $(LIBDONE)
	@if test -f $@ ; then \
		(set -x; $(LIBUPDATE) $@ DONE $(LIB_SUBDIRS)) \
	else \
		(set -x; $(LIBUPDATE) --force $@ DONE $(LIB_SUBDIRS)) \
	fi
	$(RANLIB) libkrb5.$(STEXT)
	touch libkrb5.stamp

clean-unix::
	$(RM) libkrb5.$(LIBEXT) libkrb5.stamp

clean-windows::
	$(RM) krb5.lib krb5.bak

all-windows::
	cd asn.1
	@echo Making in krb5\asn.1
	-$(MAKE) -$(MFLAGS)
	cd ..\ccache
	@echo Making in krb5\ccache
	-$(MAKE) -$(MFLAGS)
	cd ..\error_tables
	@echo Making in krb5\error_tables
	-$(MAKE) -$(MFLAGS)
	cd ..\free
	@echo Making in krb5\free
	-$(MAKE) -$(MFLAGS)
	cd ..\keytab
	@echo Making in krb5\keytab
	-$(MAKE) -$(MFLAGS)
	cd ..\krb
	@echo Making in krb5\krb
	-$(MAKE) -$(MFLAGS)
	cd ..\os
	@echo Making in krb5\os
	-$(MAKE) -$(MFLAGS)
	cd ..\posix
	@echo Making in krb5\posix
	-$(MAKE) -$(MFLAGS)
	cd ..\rcache
	@echo Making in krb5\rcache
	-$(MAKE) -$(MFLAGS)
	cd ..

clean-windows::
	cd ASN.1
	@echo Making clean in krb5\asn.1
	-$(MAKE) -$(MFLAGS) clean
	cd ..\CCACHE
	@echo Making clean in krb5\ccache
	-$(MAKE) -$(MFLAGS) clean
	cd ..\error_tables
	@echo Making clean in krb5\error_tables
	-$(MAKE) -$(MFLAGS) clean
	cd ..\FREE
	@echo Making clean in krb5\free
	-$(MAKE) -$(MFLAGS) clean
	cd ..\KEYTAB
	@echo Making clean in krb5\keytab
	-$(MAKE) -$(MFLAGS) clean
	cd ..\KRB
	@echo Making clean in krb5\krb
	-$(MAKE) -$(MFLAGS) clean
	cd ..\OS
	@echo Making clean in krb5\os
	-$(MAKE) -$(MFLAGS) clean
	cd ..\POSIX
	@echo Making clean in krb5\posix
	-$(MAKE) -$(MFLAGS) clean
	cd ..\RCACHE
	@echo Making clean in krb5\rcache
	-$(MAKE) -$(MFLAGS) clean
	cd ..
	@echo Making clean locally

