BUILDTOP=./../../$(top_dir)
SRCTOP=$(top_srcdir)/../..
##DOSBUILDTOP = ..\..

SUBDIRS=error_tables asn.1 ccache keytab krb rcache free os posix

ANAME_DBDEP=@ANAME_DBDEP@
ANAME_DBLIB=@ANAME_DBLIB@

TST=if test -n "`cat DONE`" ; then

MAC_SUBDIRS = error_tables asn.1 ccache keytab krb rcache free os posix 

LIB_SUBDIRS= error_tables asn.1 ccache ccache/stdio ccache/file ccache/memory \
	keytab keytab/file krb rcache free os posix \
        $(BUILDTOP)/util/profile
LIBUPDATE= $(BUILDTOP)/util/libupdate
LIBDONE= error_tables/DONE asn.1/DONE ccache/DONE ccache/stdio/DONE \
		ccache/file/DONE ccache/memory/DONE keytab/DONE \
		keytab/file/DONE krb/DONE rcache/DONE free/DONE os/DONE \
		posix/DONE $(BUILDTOP)/util/profile/DONE

#
CRYPTO_VER=@CRYPTO_SH_VERS@
COMERR_VER=@COMERR_SH_VERS@
DEPLIBS=$(TOPLIBD)/libcrypto.$(SHEXT).$(CRYPTO_VER) \
	$(TOPLIBD)/libcom_err.$(SHEXT).$(COMERR_VER) \
	$(ANAME_DBDEP)
SHLIB_LIBS=-lcrypto -lcom_err $(ANAME_DBLIB)
SHLIB_LDFLAGS= $(LDFLAGS) @SHLIB_RPATH_DIRS@	
#	$(LD_UNRESOLVED_PREFIX)_et_list $(LD_UNRESOLVED_PREFIX)error_message
SHLIB_LIBDIRS= @SHLIB_LIBDIRS@

all-unix:: all-recurse

all-unix:: libkrb5.a

all-windows::

libkrb5.a: $(LIBDONE)
	$(LIBUPDATE) --force $@ DONE $(LIB_SUBDIRS)
	$(RANLIB) $@
	touch libkrb5.stamp

clean-unix::
	$(RM) libkrb5.a libkrb5.stamp

clean-windows::
	$(RM) krb5.lib krb5.bak

check-unix::

all-windows::
	cd ASN.1
	@echo Making in lib\asn.1
	-$(MAKE) -$(MFLAGS)
	cd ..\CCACHE
	@echo Making in lib\ccache
	-$(MAKE) -$(MFLAGS)
	cd ..\error_tables
	@echo Making in lib\error_tables
	-$(MAKE) -$(MFLAGS)
	cd ..\FREE
	@echo Making in lib\free
	-$(MAKE) -$(MFLAGS)
	cd ..\KEYTAB
	@echo Making in lib\keytab
	-$(MAKE) -$(MFLAGS)
	cd ..\KRB
	@echo Making in lib\krb
	-$(MAKE) -$(MFLAGS)
	cd ..\OS
	@echo Making in lib\os
	-$(MAKE) -$(MFLAGS)
	cd ..\POSIX
	@echo Making in lib\posix
	-$(MAKE) -$(MFLAGS)
	cd ..\RCACHE
	@echo Making in lib\rcache
	-$(MAKE) -$(MFLAGS)
	cd ..

clean-windows::
	cd ASN.1
	@echo Making clean in lib\asn.1
	-$(MAKE) -$(MFLAGS) clean
	cd ..\CCACHE
	@echo Making clean in lib\ccache
	-$(MAKE) -$(MFLAGS) clean
	cd ..\error_tables
	@echo Making clean in lib\error_tables
	-$(MAKE) -$(MFLAGS) clean
	cd ..\FREE
	@echo Making clean in lib\free
	-$(MAKE) -$(MFLAGS) clean
	cd ..\KEYTAB
	@echo Making clean in lib\keytab
	-$(MAKE) -$(MFLAGS) clean
	cd ..\KRB
	@echo Making clean in lib\krb
	-$(MAKE) -$(MFLAGS) clean
	cd ..\OS
	@echo Making clean in lib\os
	-$(MAKE) -$(MFLAGS) clean
	cd ..\POSIX
	@echo Making clean in lib\posix
	-$(MAKE) -$(MFLAGS) clean
	cd ..\RCACHE
	@echo Making clean in lib\rcache
	-$(MAKE) -$(MFLAGS) clean
	cd ..
	@echo Making clean locally

