CFLAGS = $(CCOPTS) $(DEFS)
KRB5_RUN_ENV = @KRB5_RUN_ENV@

LIB=kdb5
LIBMAJOR=1
LIBMINOR=0
RELDIR=kdb
# Depends on libcrypto and libkrb5
SHLIB_EXPDEPS = \
	$(TOPLIBD)/libcrypto$(SHLIBEXT) \
	$(TOPLIBD)/libkrb5$(SHLIBEXT)
SHLIB_EXPLIBS=-lkrb5 -lcom_err 
SHLIB_DIRS=-L$(TOPLIBD)
SHLIB_RDIRS=$(KRB5_LIBDIR)


all:: 

SRCS= \
	$(srcdir)/keytab.c \
	$(srcdir)/encrypt_key.c \
	$(srcdir)/decrypt_key.c \
	$(srcdir)/kdb_cpw.c \
	$(srcdir)/kdb_dbm.c \
	$(srcdir)/kdb_xdr.c \
	$(srcdir)/verify_mky.c \
	$(srcdir)/fetch_mkey.c \
	$(srcdir)/setup_mkey.c \
	$(srcdir)/store_mkey.c

STOBJLISTS=OBJS.ST
STLIBOBJS= \
	keytab.o \
	encrypt_key.o \
	decrypt_key.o \
	kdb_cpw.o \
	kdb_dbm.o \
	kdb_xdr.o \
	verify_mky.o \
	fetch_mkey.o \
	setup_mkey.o \
	store_mkey.o

all-unix:: all-liblinks
install-unix:: install-libs
clean-unix:: clean-liblinks clean-libs clean-libobjs

t_kdb:	t_kdb.o $(OBJS) $(TOPLIBD)/libkrb5.a $(TOPLIBD)/libcrypto.a $(TOPLIBD)/libcom_err.a $(TOPLIBD)/libdb.a
	$(LD) $(LDFLAGS) $(LDARGS) -o t_kdb t_kdb.o $(OBJS) $(LIBS) $(TOPLIBD)/libdb.a

check::	t_kdb
	KRB5_CONFIG=$(srcdir)/t_krb5.conf ; export KRB5_CONFIG ;\
		$(KRB5_RUN_ENV) ./t_kdb -tcv
	KRB5_CONFIG=$(srcdir)/t_krb5.conf ; export KRB5_CONFIG ;\
		$(KRB5_RUN_ENV) ./t_kdb -tcvr

clean::
	$(RM) t_kdb t_kdb.o

