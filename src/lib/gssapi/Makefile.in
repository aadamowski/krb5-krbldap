TST=if test -n "`cat DONE`" ; then

##DOSBUILDTOP = ..\..
##DOSLIBNAME=gssapi.lib
##DOSOBJFILELIST=@generic.lst @krb5.lst
##DOSOBJFILEDEP=generic.lst krb5.lst

MAC_SUBDIRS = generic krb5

CRYPTO_VER=@CRYPTO_SH_VERS@
COMERR_VER=@COMERR_SH_VERS@
KRB5_VER=@KRB5_SH_VERS@
DEPLIBS=$(TOPLIBD)/libcrypto.$(SHEXT).$(CRYPTO_VER) \
	$(TOPLIBD)/libcom_err.$(SHEXT).$(COMERR_VER) \
	$(TOPLIBD)/libkrb5.$(SHEXT).$(KRB5_VER)
LIB_SUBDIRS= generic krb5
LIBDONE= generic/DONE krb5/DONE # mechglue/DONE
LIBUPDATE= $(BUILDTOP)/util/libupdate

SHLIB_LIBS=-lkrb5 -lcrypto -lcom_err
SHLIB_LDFLAGS= $(LDFLAGS) @SHLIB_RPATH_DIRS@	
SHLIB_LIBDIRS= @SHLIB_LIBDIRS@

all-unix::
all-mac::

libgssapi_krb5.$(STEXT): $(LIBDONE)
	@if test -f $@ ; then \
		(set -x; $(LIBUPDATE) $@ DONE $(LIB_SUBDIRS)) \
	else \
		(set -x; $(LIBUPDATE) --force $@ DONE $(LIB_SUBDIRS)) \
	fi
	$(RANLIB) libgssapi_krb5.$(STEXT)
	touch libgssapi_krb5.stamp

install:: libgssapi_krb5.a
	$(INSTALL_DATA) libgssapi_krb5.a $(DESTDIR)$(KRB5_LIBDIR)/libgssapi_krb5.a
	$(RANLIB) $(DESTDIR)$(KRB5_LIBDIR)/libgssapi_krb5.a

clean-unix::
	$(RM) libgssapi_krb5.a libgssapi_krb5.stamp

clean-mac::
	$(RM) libgssapi_krb5.a

clean-windows::
	$(RM) gssapi.lib gssapi.bak

all-windows::
	cd generic
	@echo Making in gssapi\generic
	-$(MAKE) -$(MFLAGS)
	cd ..\krb5
	@echo Making in gssapi\krb5
	-$(MAKE) -$(MFLAGS)
#	cd ..\mechglue
#	@echo Making in gssapi\mechglue
#	-$(MAKE) -$(MFLAGS)
	cd ..

clean-windows::
	cd generic
	@echo Making clean in gssapi\generic
	-$(MAKE) -$(MFLAGS) clean
	cd ..\krb5
	@echo Making clean in gssapi\krb5
	-$(MAKE) -$(MFLAGS) clean
#	cd ..\mechglue
#	@echo Making clean in gssapi\mechglue
#	-$(MAKE) -$(MFLAGS) clean
	cd ..
	@echo Making clean in gssapi

