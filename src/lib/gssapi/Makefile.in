TST=if test -n "`cat DONE`" ; then

##DOSBUILDTOP = ..\..

MAC_SUBDIRS = generic krb5 mechglue

CRYPTO_VER=@CRYPTO_SH_VERS@
COMERR_VER=@COMERR_SH_VERS@
KRB5_VER=@KRB5_SH_VERS@
DEPLIBS=$(TOPLIBD)/libcrypto.$(SHEXT).$(CRYPTO_VER) \
	$(TOPLIBD)/libcom_err.$(SHEXT).$(COMERR_VER) \
	$(TOPLIBD)/libkrb5.$(SHEXT).$(KRB5_VER)
LIB_SUBDIRS= generic krb5
LIBDONE= generic/DONE krb5/DONE # mechglue/DONE
LIBUPDATE= $(BUILDTOP)/util/libupdate

SHLIB_LIBS=-lkrb5 -lcrypto -lcom_err
SHLIB_LDFLAGS= $(LDFLAGS) @SHLIB_RPATH_DIRS@	
SHLIB_LIBDIRS= @SHLIB_LIBDIRS@

all-unix::

all-mac::

libgssapi_krb5.$(STEXT): $(LIBDONE)
	if test -f $@ ; then \
		for i in $(LIB_SUBDIRS) ; \
		do \
			$(LIBUPDATE) $@ $$i/DONE $$i ; \
		done ; \
	else \
		for i in $(LIB_SUBDIRS) ; \
		do \
			$(LIBUPDATE) --force $@ $$i/DONE $$i ; \
		done ; \
	fi
	$(RANLIB) libgssapi_krb5.$(STEXT)
	touch libgssapi_krb5.stamp

install:: libgssapi_krb5.a
	$(INSTALL_DATA) libgssapi_krb5.a $(DESTDIR)$(KRB5_LIBDIR)/libgssapi_krb5.a
	$(RANLIB) $(DESTDIR)$(KRB5_LIBDIR)/libgssapi_krb5.a

clean-unix::
	$(RM) libgssapi_krb5.a

clean-mac::
	$(RM) libgssapi_krb5.a

clean-windows::
	$(RM) gssapi.lib gssapi.bak

all-windows::
	cd generic
	@echo Making in gssapi\generic
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..\krb5
	@echo Making in gssapi\krb5
	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
#	cd ..\mechglue
#	@echo Making in gssapi\mechglue
#	-$(MAKE) -$(MFLAGS) LIBCMD=$(LIBCMD)
	cd ..

clean-windows::
	cd generic
	@echo Making clean in gssapi\generic
	-$(MAKE) -$(MFLAGS) clean
	cd ..\krb5
	@echo Making clean in gssapi\krb5
	-$(MAKE) -$(MFLAGS) clean
#	cd ..\mechglue
#	@echo Making clean in gssapi\mechglue
#	-$(MAKE) -$(MFLAGS) clean
	cd ..
	@echo Making clean in gssapi

