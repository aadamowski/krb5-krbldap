2006-05-25  Tom Yu  <tlyu@mit.edu>

	* spnego_mech.c (acc_ctx_call_acc): Wrap call to
	gss_accept_sec_context().
	(acc_ctx_vfy_oid): New function to verify that mech OID is sane.
	(handle_mic): Delete no-op conditional.
	(init_ctx_cont): Check for "empty" reply token.  Add minor status
	return.
	(init_ctx_nego): Add minor status returns.
	(acc_ctx_new): Stash mech_wanted into sc->internal_mech.
	(acc_ctx_cont): Improve error handling.  Reject "empty" token.
	(spnego_gss_accept_sec_context): Break pieces out into
	acc_ctx_call_acc().
	(make_spnego_tokenTarg_msg): Don't send supportedMech on
	non-initial reply from acceptor.

2006-05-19  Tom Yu  <tlyu@mit.edu>

	* spnego_mech.c: General misc. minor cleanup.
	(spnego_gss_init_sec_context): Implement RFC 4178 handling of
	MICs.  Split into new functions init_ctx_new, init_ctx_cont,
	init_ctx_nego, init_ctx_reselect, and init_ctx_call_init.
	(acc_ctx_vfymic): Delete.
	(handle_mic, process_mic): New functions to handle verification
	and generation of MICs for both initiator and acceptor.
	(acc_ctx_cont): Explicitly set negState on success.
	(put_mech_set): Encode into a gss_buffer_t instead.
	(make_spnego_tokenInit_msg): Fix some ASN.1 encoding bugs.

	* gssapiP_spnego.h: Change ACCEPT_DEFECTIVE_TOKEN value.  Add some
	additional state variables to spnego_gss_ctx_id_rec, and delete
	some unused ones.

2006-05-10  Tom Yu  <tlyu@mit.edu>

	* spnego_mech.c (acc_ctx_cont): Fix typo in call to
	get_negTokenResp.
	(acc_ctx_vfymic): Set NO_TOKEN_SEND if we're done and aren't
	sending a MIC this round, so we don't send a useless negotiation
	token.
	(spnego_gss_accept_sec_context): Default to GSS_S_CONTINUE_NEEDED
	when acc_ctx_cont succeeds.  Don't try to process the mechanism
	token if we're requesting a MIC.  Fix typo in conditional
	controlling whether to call make_spnego_tokenTarg_msg.
	(make_spnego_tokenTarg_msg): Fix to actually work when sendtoken
	is CONT_TOKEN_SEND.

2006-05-04  Tom Yu  <tlyu@mit.edu>

	* gssapiP_spnego.h: Add REQUEST_MIC.  Add many state variables to
	spnego_gss_ctx_id_rec.

	* spnego_mech.c: New functions acc_ctx_new, acc_ctx_cont,
	acc_ctx_vfymic, get_negTokenInit, get_negTokenResp.
	(spnego_gss_accept_sec_context): Split into smaller pieces.
	Implement RFC 4178 handling of MIC optionality.
	(g_get_tag_and_length): Tighten up some length checks.  Take an
	int rather than unsigned char for tag.
	(make_spnego_tokenTarg_msg): Tweak error handling.  Remove MS_flag
	argument.
	(negotiate_mech_type): Remove firstMech argument.  Use negResult
	to indicate what firstMech used to.
	(get_req_flags): Tweak error handling.

2006-03-28  Tom Yu  <tlyu@.mit.edu>

	* spnego_mech.c (check_spnego_options, create_spnego_ctx): Force
	to 1 for testing purposes.
	(spnego_gss_init_sec_context): Don't check for mechListMIC if
	MS_Interop is true.
	(make_spnego_tokenTarg_msg): Never send duplicate AP-REP as
	mechListMIC; omit mechListMIC instead.

2006-03-26  Tom Yu  <tlyu@mit.edu>

	* spnego_mech.c: s/uchar_t/unsigned char/g.  Bash cast to
	uint32_t, but that should get looked at again in detail.

	* gssapiP_spnego.h: Don't include synch.h.

	* spnego_mech.c (spnego_mechanism): Tweak for correct ordering of
	pointers.
	(gss_mech_initialize): Disable for now.

2006-03-10  Tom Yu  <tlyu@mit.edu>

	* gssapiP_spnego.h, spnego_mech.c: Rename symbols for namespace
	purity.
